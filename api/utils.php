<?php session_start(); function json_input(){ $raw=file_get_contents('php://input'); $d=json_decode($raw,true); return is_array($d)?$d:[]; } function json_out($d,$c=200){ http_response_code($c); header('Content-Type: application/json'); echo json_encode($d); exit; } function require_login(){ if(!isset($_SESSION['user_id'])) json_out(['error'=>'Unauthorized'],401); } function sanitize_patch($i,$a){ $o=[]; foreach($i as $k=>$v){ if(in_array($k,$a,true)) $o[$k]=$v; } return $o; } function build_set_clause($f){ $p=[]; foreach($f as $k=>$v){ $p[]="`$k`=:${k}"; } return implode(', ',$p); } ?>