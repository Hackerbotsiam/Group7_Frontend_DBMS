async function count(res){try{const r=await apiList(res,{limit:1});return r.total??r.length}catch(_){return 0}} async function refreshCounts(){document.getElementById('countProducts').textContent=await count('agricultural_products');document.getElementById('countInputs').textContent=await count('agri_inputs');document.getElementById('countPerish').textContent=await count('perishable_products');document.getElementById('countPost').textContent=await count('post_harvest');} function esc(s){return String(s).replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;'}[c]));} async function refreshMarket(){const rows=await apiList('market_data',{limit:10,offset:0}).catch(()=>[]);const tbody=document.querySelector('#marketTable tbody');tbody.innerHTML='';rows.forEach(r=>{const tr=document.createElement('tr');tr.innerHTML=`<td>${esc(r.market_name||'')}</td><td>${esc(r.product||'')}</td><td>${r.price_per_unit??''}</td><td>${r.price_date??''}</td>`;tbody.appendChild(tr);});} document.getElementById('logoutBtn').addEventListener('click',async()=>{await apiLogout();location.href='./login.html';}); refreshCounts(); refreshMarket();